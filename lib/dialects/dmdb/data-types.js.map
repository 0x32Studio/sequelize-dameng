{
  "version": 3,
  "sources": ["../../../src/dialects/dmdb/data-types.js"],
  "sourcesContent": ["'use strict';\n\nconst wkx = require('wkx');\nconst _ = require('lodash');\nconst momentTz = require('moment-timezone');\nconst moment = require('moment');\n\nmodule.exports = BaseTypes => {\n  BaseTypes.ABSTRACT.prototype.dialectTypes = 'https://eco.dameng.com/docs/zh-cn/sql-dev/dmpl-sql-datatype.html';\n\n  BaseTypes.DATE.types.dm = ['TIMESTAMP'];\n  BaseTypes.STRING.types.dm = ['VAR_STRING'];\n  BaseTypes.CHAR.types.dm = ['STRING'];\n  BaseTypes.TEXT.types.dm = ['BLOB'];\n  BaseTypes.TINYINT.types.dm = ['TINY'];\n  BaseTypes.SMALLINT.types.dm = ['SHORT'];\n  BaseTypes.MEDIUMINT.types.dm = ['INT24'];\n  BaseTypes.INTEGER.types.dm = ['LONG'];\n  BaseTypes.BIGINT.types.dm = ['LONGLONG'];\n  BaseTypes.FLOAT.types.dm = ['FLOAT'];\n  BaseTypes.TIME.types.dm = ['TIME'];\n  BaseTypes.DATEONLY.types.dm = ['DATE'];\n  BaseTypes.BOOLEAN.types.dm = ['TINY'];\n  BaseTypes.BLOB.types.dm = ['TINYBLOB', 'BLOB', 'LONGBLOB'];\n  BaseTypes.DECIMAL.types.dm = ['NEWDECIMAL'];\n  BaseTypes.UUID.types.dm = false;\n  BaseTypes.ENUM.types.dm = false;\n  BaseTypes.REAL.types.dm = ['DOUBLE'];\n  BaseTypes.DOUBLE.types.dm = ['DOUBLE'];\n  BaseTypes.GEOMETRY.types.dm = ['GEOMETRY'];\n  BaseTypes.JSON.types.dm = ['JSON'];\n\n  class DECIMAL extends BaseTypes.DECIMAL {\n    toSql() {\n      let definition = super.toSql();\n      if (this._unsigned) {\n        definition += ' UNSIGNED';\n      }\n      if (this._zerofill) {\n        definition += ' ZEROFILL';\n      }\n      return definition;\n    }\n  }\n\n  class DATE extends BaseTypes.DATE {\n    toSql() {\n      return this._length ? `TIMESTAMP(${this._length})` : 'TIMESTAMP';\n    }\n    _stringify(date, options) {\n      if (!moment.isMoment(date)) {\n        date = this._applyTimezone(date, options);\n      }\n      if (this._length) {\n        return date.format(`YYYY-MM-DD HH:mm:ss.${new Array(this._length).fill('S').join()}`);\n      }\n      return date.format('YYYY-MM-DD HH:mm:ss');\n    }\n    static parse(value, options) {\n      value = value.string();\n      if (value === null) {\n        return value;\n      }\n      if (momentTz.tz.zone(options.timezone)) {\n        value = momentTz.tz(value, options.timezone).toDate();\n      }\n      else {\n        value = new Date(`${value} ${options.timezone}`);\n      }\n      return value;\n    }\n  }\n\n  class DATEONLY extends BaseTypes.DATEONLY {\n    static parse(value) {\n      return value.string();\n    }\n  }\n\n  class TIME extends BaseTypes.TIME {\n    toSql() {\n      return `TIME${this._length ? `(${this._length})` : ''}`;\n    }\n    _stringify(date, options) {\n      if (!moment.isMoment(date)) {\n        date = this._applyTimezone(date, options);\n      }\n      if (this._length) {\n        return date.format(`HH:mm:ss.${new Array(this._length).fill('S').join('')}`);\n      }\n      return date.format('HH:mm:ss');\n    }\n  }\n\n  class UUID extends BaseTypes.UUID {\n    toSql() {\n      return 'CHAR(36) BINARY';\n    }\n  }\n\n  const SUPPORTED_GEOMETRY_TYPES = ['POINT', 'LINESTRING', 'POLYGON'];\n\n  class GEOMETRY extends BaseTypes.GEOMETRY {\n    constructor(type, srid) {\n      super(type, srid);\n      if (_.isEmpty(this.type)) {\n        this.sqlType = this.key;\n        return;\n      }\n      if (SUPPORTED_GEOMETRY_TYPES.includes(this.type)) {\n        this.sqlType = this.type;\n        return;\n      }\n      throw new Error(`Supported geometry types are: ${SUPPORTED_GEOMETRY_TYPES.join(', ')}`);\n    }\n    static parse(value) {\n      value = value.buffer();\n      // Empty buffer, MySQL doesn't support POINT EMPTY\n      // check, https://dev.mysql.com/worklog/task/?id=2381\n      if (!value || value.length === 0) {\n        return null;\n      }\n      // For some reason, discard the first 4 bytes\n      value = value.slice(4);\n      return wkx.Geometry.parse(value).toGeoJSON({ shortCrs: true });\n    }\n    toSql() {\n      return this.sqlType;\n    }\n  }\n\n  class ENUM extends BaseTypes.ENUM {\n    toSql(options) {\n      return `ENUM(${this.values.map(value => options.escape(value)).join(', ')})`;\n    }\n  }\n\n  class JSONTYPE extends BaseTypes.JSON {\n    _stringify(value, options) {\n      return options.operation === 'where' && typeof value === 'string' ? value : JSON.stringify(value);\n    }\n  }\n\n  class BOOLEAN extends BaseTypes.BOOLEAN {\n    toSql() {\n      return 'BIT';\n    }\n  }\n\n  return {\n    ENUM,\n    DATE,\n    DATEONLY,\n    TIME,\n    UUID,\n    GEOMETRY,\n    DECIMAL,\n    JSON: JSONTYPE,\n    BOOLEAN\n  };\n};\n"],
  "mappings": "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",
  "names": []
}
